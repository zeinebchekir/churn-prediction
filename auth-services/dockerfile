# Étape 1 : Utiliser Node.js
FROM node:22

# Étape 2 : Définir le dossier de travail
WORKDIR /app

# Étape 3 : Copier les fichiers et installer les dépendances
COPY package.json package-lock.json ./
RUN npm install

# Étape 4 : Copier le code source
COPY . .
ENV MONGO_URI=mongodb://mongo-db:27017/userDB
ENV SERVICE_URI=auth-services:50052
ENV KEYCLOAK_DOMAIN=http://localhost:9081
ENV KEYCLOAK_REALM=projects
ENV KEYCLOAK_LOGIN_URL=http://localhost:9081/realms/projects/protocol/openid-connect/token
ENV KEYCLOAK_ADMIN_BASE_URL=http://localhost:9081/admin/realms/projects
ENV KEYCLOAK_ADMIN_CLIENT_ID=telecommProject
ENV KEYCLOAK_ADMIN_CLIENT_SECRET=vxnapaIPs4W0hdgPFNAUvv7rDtB5RKB8
ENV KEYCLOAK_ADMIN_LINK_LIFESPAN=88997
ENV KEYCLOAK_ADMIN_REDIRECT_URL=http:localhost:4200
ENV KEYCLOAK_CLIENT_FACING_CLIENT_ID=auth-client
ENV KEYCLOAK_CLIENT_FACING_CLIENT_SECRET=FKJptWtEs9pFuoyQxOK3zMPqZha0j8lt
# Étape 5 : Exposer le port et lancer l'application
EXPOSE 50052
CMD ["npm", "run", "start:dev"]
